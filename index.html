<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Happy Birthday</title>

<link rel="stylesheet" href="file/default.css">

<style>
body {
    margin: 0;
    overflow: hidden;
    background: url("https://4kwallpapers.com/images/walls/thumbs_3t/9983.jpg")
        center / cover no-repeat fixed;
}

/* move text LEFT so it's readable */
#text {
    position: absolute;
    left: 20px;   /* was 60px */
    top: 80px;
    width: 420px;
}

#clock-box {
    position: absolute;
    left: 20px;   /* was 60px */
    top: 420px;
}


#clock-box span {
    color: #3a0030;
    font-weight: 700;
}

#canvas {
    filter: drop-shadow(0 0 18px rgba(255,120,180,0.65));
}

/* falling flowers canvas */
#petals {
    position: fixed;
    inset: 0;
    pointer-events: none;
}
</style>

<script src="file/jquery.min.js"></script>
<script src="file/jscex.min.js"></script>
<script src="file/jscex-parser.js"></script>
<script src="file/jscex-jit.js"></script>
<script src="file/jscex-builderbase.min.js"></script>
<script src="file/jscex-async.min.js"></script>
<script src="file/jscex-async-powerpack.min.js"></script>
<script src="file/function.js"></script>
<script src="file/love.js"></script>
</head>

<body>
<div id="main">

<audio autoplay loop id="myAudio">
    <source src="aud.mp3" type="audio/mp3">
</audio>

<canvas id="petals"></canvas>

<div id="wrap">
    <div id="text">
        <div id="code">
            <span class="say">Hey my love</span><br>

            <span class="say">Happy Birthday</span><br>

            <span class="say">You became my favorite </span><br>

            <span class="say">feeling </span><br>
            
            <span class="say">Without even trying</span><br><br>

            <span class="say">Your existence fulfilled my life </span><br><br>

            <span class="say">Your smile stays with me</span><br>

            <span class="say">Even when the day ends</span><br>

            <span class="say">And thatâ€™s my quiet happiness</span><br><br>

            <span class="say">Today is yours</span><br>
            
            <span class="say">And every day after, I choose you</span><br>
        </div>
    </div>

    <div id="clock-box">
        <span id="clock">577 days 0 hours 0 minutes 0 seconds</span>
    </div>

    <canvas id="canvas" width="1100" height="680"></canvas>
</div>
</div>

<script>
/* TREE + HEART FLOWERS */
(function () {
    var canvas = $("#canvas");
    var width = canvas.width();
    var height = canvas.height();
    canvas.attr("width", width);
    canvas.attr("height", height);

    var opts = {
        seed: { x: width / 2 - 20, color: "rgb(255,64,129)", scale: 2 },
        branch: [
            [535, 680, 570, 250, 500, 200, 30, 100, [
                [540, 500, 455, 417, 340, 400, 13, 100],
                [550, 445, 600, 356, 680, 345, 12, 100],
                [546, 357, 608, 252, 678, 221, 6, 100]
            ]]
        ],
        bloom: { num: 7000, width: width, height: height },
        footer: { width: 1200, height: 5, speed: 10 }
    };

    var tree = new Tree(canvas[0], width, height, opts);
    var seed = tree.seed;
    var foot = tree.footer;
    var hold = 1;

    canvas.click(function () { hold = 0; });

    var seedAnimate = eval(Jscex.compile("async", function () {
        seed.draw();
        while (hold) $await(Jscex.Async.sleep(10));
        while (seed.canScale()) {
            seed.scale(0.95);
            $await(Jscex.Async.sleep(10));
        }
        while (seed.canMove()) {
            seed.move(0, 2);
            foot.draw();
            $await(Jscex.Async.sleep(10));
        }
    }));

    var growAndFlowerAnimate = eval(Jscex.compile("async", function () {
        while (tree.canGrow()) {
            tree.grow();
            tree.flower(4); // heart flowers during growth
            $await(Jscex.Async.sleep(10));
        }
        while (tree.canFlower()) {
            tree.flower(28);
            $await(Jscex.Async.sleep(8));
        }
    }));

    var textAnimate = eval(Jscex.compile("async", function () {
        $("#code").show().typewriter();
    }));

    var runAsync = eval(Jscex.compile("async", function () {
        $await(seedAnimate());
        $await(growAndFlowerAnimate());
        textAnimate().start();
    }));

    runAsync().start();
})();
</script>

<script>
/* FLOWING / FALLING FLOWERS */
const petalCanvas = document.getElementById("petals");
const ctx = petalCanvas.getContext("2d");
petalCanvas.width = window.innerWidth;
petalCanvas.height = window.innerHeight;

const petals = [];
for (let i = 0; i < 120; i++) {
    petals.push({
        x: Math.random() * petalCanvas.width,
        y: Math.random() * petalCanvas.height,
        r: Math.random() * 4 + 2,
        s: Math.random() * 1 + 0.5,
        a: Math.random() * Math.PI * 2
    });
}

function drawPetal(p) {
    ctx.save();
    ctx.translate(p.x, p.y);
    ctx.rotate(p.a);
    ctx.fillStyle = "rgba(255,120,180,0.85)";
    ctx.beginPath();
    ctx.moveTo(0, 0);
    ctx.bezierCurveTo(-p.r, -p.r, -p.r * 2, p.r, 0, p.r * 2);
    ctx.bezierCurveTo(p.r * 2, p.r, p.r, -p.r, 0, 0);
    ctx.fill();
    ctx.restore();
}

function animatePetals() {
    ctx.clearRect(0, 0, petalCanvas.width, petalCanvas.height);
    petals.forEach(p => {
        p.y += p.s;
        p.x += Math.sin(p.a) * 0.3;
        p.a += 0.01;
        if (p.y > petalCanvas.height) {
            p.y = -10;
            p.x = Math.random() * petalCanvas.width;
        }
        drawPetal(p);
    });
    requestAnimationFrame(animatePetals);
}
animatePetals();
</script>
</body>
</html>